<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Скальд</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>>"Скальд"</h1>
        <h1>Редактор диалогов и квестов для KGMarketplace</h1>
        <h1>>by OdinSons </h1>
        <div class="header-controls">
            <input type="text" id="searchInput" placeholder="Поиск по диалогам...">
            <button id="importDialogueBtn">Импорт cfg диалога</button>
            <button id="importQuestBtn">Импорт cfg квеста</button>
            <button id="questsBtn">Квесты</button>
            <button id="exportBtn">Экспорт в cfg</button>
            <button id="validateBtn">Проверить</button>
            <button id="previewBtn" class="play-btn">▶</button>
        </div>
    </header>

    <main>
        <div class="workspace">
            <div class="toolbar">
                <button id="addNodeBtn">+ Добавить диалог</button>
                <button id="addOptionBtn">+ Добавить опцию</button>
                <button id="deleteBtn">Удалить</button>
                <div class="tool-separator"></div>
                <button id="zoomInBtn">+</button>
                <button id="zoomOutBtn">-</button>
                <button id="fitToScreenBtn">По размеру</button>
            </div>

            <div class="canvas-container">
                <svg id="connectionLayer">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                                refX="10" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#3498db"/>
                        </marker>
                    </defs>
                </svg>
                <div id="nodeContainer" class="node-container"></div>
            </div>
        </div>

        <div class="properties-panel">
            <div id="nodeProperties" class="properties-section">
                <h3>Диалог NPC</h3>
                <div class="form-group">
                    <label>ID профиля:</label>
                    <input type="text" id="nodeId" class="form-control">
                </div>
                <div class="form-group">
                    <label>Текст NPC:</label>
                    <textarea id="nodeText" class="form-control" rows="3" placeholder="Используем \n для переноса строки и теги &lt;color&gt;"></textarea>
                </div>
                
                <div class="node-options-section">
                    <h4>Опции диалога</h4>
                    <div id="nodeOptionsList" class="options-list"></div>
                    <button id="addNodeOptionBtn" class="btn-small">+ Добавить опцию</button>
                </div>
            </div>

            <div id="optionProperties" class="properties-section" style="display: none;">
                <h3>Опция игрока</h3>
                <div class="form-group">
                    <label>Текст:</label>
                    <input type="text" id="optionText" class="form-control">
                </div>
                <div class="form-group">
                    <label>Переход к:</label>
                    <select id="optionTransition" class="form-control">
                        <option value="">-- Нет --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Иконка:</label>
                    <input type="text" id="optionIcon" class="form-control" placeholder="Hammer, SwordIron, etc.">
                </div>
                <div class="form-group">
                    <label>Цвет:</label>
                    <input type="color" id="optionColor" class="form-control" value="#ffffff">
                </div>

                <div class="conditions-section">
                    <h4>Условия</h4>
                    <div id="conditionsList"></div>
                    <button id="addConditionBtn" class="btn-small">+ Добавить условие</button>
                </div>

                <div class="commands-section">
                    <h4>Команды</h4>
                    <div id="commandsList"></div>
                    <button id="addCommandBtn" class="btn-small">+ Добавить команду</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Модальные окна -->
    <div id="previewModal" class="modal" style="display: none;">
        <div class="modal-content preview-modal">
            <div class="modal-header">
                <h2>Предпросмотр диалога</h2>
                <span class="close">&times;</span>
            </div>
            <div id="previewContent" class="preview-content"></div>
        </div>
    </div>

    <div id="questsModal" class="modal" style="display: none;">
        <div class="modal-content quests-modal">
            <div class="modal-header">
                <h2>Редактор квестов</h2>
                <span class="close">&times;</span>
            </div>
            <div class="quests-container">
                <div class="quests-sidebar">
                    <div class="quests-header">
                        <h3>Квесты</h3>
                        <button id="addQuestBtn" class="btn-small">+ Новый квест</button>
                    </div>
                    <div id="questsList" class="quests-list"></div>
                </div>
                <div class="quest-editor">
                    <div id="questEditor" class="quest-editor-content">
                        <div class="no-quest-selected">
                            <p>Выберите квест для редактирования</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="questPreviewModal" class="modal" style="display: none;">
        <div class="modal-content quest-preview-modal">
            <div class="modal-header">
                <h2>Предпросмотр квеста</h2>
                <span class="close">&times;</span>
            </div>
            <div id="questPreviewContent" class="quest-preview-content"></div>
        </div>
    </div>

    <div id="conditionModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Добавить условие</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Тип условия:</label>
                    <select id="conditionType" class="form-control">
                        <option value="HasItem">HasItem</option>
                        <option value="NotHasItem">NotHasItem</option>
                        <option value="SkillMore">SkillMore</option>
                        <option value="QuestFinished">QuestFinished</option>
                        <option value="NotFinished">NotFinished</option>
                        <option value="HasQuest">HasQuest</option>
                        <option value="NotHasQuest">NotHasQuest</option>
                        <option value="GlobalKey">GlobalKey</option>
                        <option value="NotGlobalKey">NotGlobalKey</option>
                    </select>
                </div>
                <div id="conditionParams"></div>
                <button id="saveConditionBtn">Сохранить</button>
            </div>
        </div>
    </div>

    <div id="commandModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Добавить команду</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Тип команды:</label>
                    <select id="commandType" class="form-control">
                        <option value="GiveItem">GiveItem</option>
                        <option value="RemoveItem">RemoveItem</option>
                        <option value="GiveQuest">GiveQuest</option>
                        <option value="FinishQuest">FinishQuest</option>
                        <option value="RemoveQuest">RemoveQuest</option>
                        <option value="OpenUI">OpenUI</option>
                        <option value="PlaySound">PlaySound</option>
                        <option value="Spawn">Spawn</option>
                        <option value="Teleport">Teleport</option>
                        <option value="Damage">Damage</option>
                        <option value="Heal">Heal</option>
                        <option value="GiveBuff">GiveBuff</option>
                        <option value="AddPin">AddPin</option>
                    </select>
                </div>
                <div id="commandParams"></div>
                <button id="saveCommandBtn">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Модальные окна для квестов -->
    <div id="questTargetModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Добавить цель квеста</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Префаб объекта:</label>
                    <input type="text" id="targetPrefab" class="form-control" placeholder="Wolf, Skeleton, SwordIron">
                </div>
                <div class="form-group">
                    <label>Количество:</label>
                    <input type="number" id="targetAmount" class="form-control" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Минимальный уровень (опционально):</label>
                    <input type="number" id="targetLevel" class="form-control" value="" min="1" placeholder="Оставьте пустым если не требуется">
                </div>
                <button id="saveQuestTargetBtn">Сохранить цель</button>
            </div>
        </div>
    </div>

    <div id="questRewardModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Добавить награду квеста</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Тип награды:</label>
                    <select id="rewardType" class="form-control">
                        <option value="Item">Предмет</option>
                        <option value="Skill">Навык (уровни)</option>
                        <option value="Skill_EXP">Навык (опыт)</option>
                        <option value="EpicMMO_EXP">EpicMMO опыт</option>
                        <option value="AddCustomValue">Добавить кастомное значение</option>
                        <option value="SetCustomValue">Установить кастомное значение</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Префаб/Название:</label>
                    <input type="text" id="rewardPrefab" class="form-control" placeholder="SwordIron, Run, Coins">
                </div>
                <div class="form-group">
                    <label>Количество:</label>
                    <input type="number" id="rewardAmount" class="form-control" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Уровень (для предметов):</label>
                    <input type="number" id="rewardLevel" class="form-control" value="1" min="1">
                </div>
                <button id="saveQuestRewardBtn">Сохранить награду</button>
            </div>
        </div>
    </div>

    <div id="questRequirementModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Добавить требование квеста</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Тип требования:</label>
                    <select id="requirementType" class="form-control">
                        <option value="HasItem">Имеет предмет</option>
                        <option value="NotHasItem">Не имеет предмет</option>
                        <option value="SkillMore">Навык больше</option>
                        <option value="SkillLess">Навык меньше</option>
                        <option value="QuestFinished">Квест завершен</option>
                        <option value="NotFinished">Квест не завершен</option>
                        <option value="HasQuest">Имеет квест</option>
                        <option value="NotHasQuest">Не имеет квест</option>
                        <option value="GlobalKey">Имеет глобальный ключ</option>
                        <option value="NotGlobalKey">Не имеет глобальный ключ</option>
                    </select>
                </div>
                <div id="requirementParams"></div>
                <button id="saveQuestRequirementBtn">Сохранить требование</button>
            </div>
        </div>
    </div>

    <!-- Скрытые inputs для импорта файлов -->
    <input type="file" id="dialogueFileInput" accept=".cfg" style="display: none;">
    <input type="file" id="questFileInput" accept=".cfg" style="display: none;">

    <script src="script.js"></script>
</body>
</html>
